import app.StartDesktopApp;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

import analysis.Complexity;
import app.DesktopApp;
import app.PlayerApp;
import app.loading.FileLoading;
import app.utils.AIPlayer;
import app.utils.ReportMessengerGUI;
import gnu.trove.map.hash.TObjectDoubleHashMap;
import main.grammar.Report;
import metrics.Evaluation;
import metrics.Metric;
import metrics.designer.IdealDuration;
import metrics.designer.SkillTrace;


/**
 * The main method of this launches the Ludii application with its GUI, and registers
 * the example AIs from this project such that they are available inside the GUI.
 */
public class LaunchLudii
{
	/**
	 * The main method
	 * @param args
	 */
	public static void main(final String[] args)
	{
		// Run Ludii
		StartDesktopApp.main(new String[0]);
		
		
		
		
		
		final List<Metric> metrics = new Evaluation().dialogMetrics();
		final ArrayList<Double> weights = new ArrayList<>();
		
		final int maxTurns = Integer.valueOf(textFieldMaxTurns.getText().toString()).intValue();
		final int numberIterations = Integer.valueOf(textFieldNumberTrials.getText().toString()).intValue();
		
		double thinkTime = 0.5;
		String AIName = null;
		
		switch(comboBoxAIAgents.getSelectedItem().toString())
		{
			case "Random": AIName = "Random"; break;
			case "Very weak AI": AIName = "Ludii AI"; thinkTime = 0.1; break;
			case "Weak AI": AIName = "Ludii AI"; thinkTime = 0.5; break;
			case "Strong AI": AIName = "Ludii AI"; thinkTime = 2.0; break;
			case "Very strong AI": AIName = "Ludii AI"; thinkTime = 5.0; break;
			case "Custom": AIName = comboBoxAlgorithm.getSelectedItem().toString(); thinkTime = Double.valueOf(textFieldThinkTime.getText()).doubleValue(); break;
		}
		
		for (final Metric m : metrics)
		{
			if (m instanceof IdealDuration)
			{
				((IdealDuration)m).setMinTurn(Double.valueOf(textFieldMinIdealTurns.getText()).doubleValue());
				((IdealDuration)m).setMaxTurn(Double.valueOf(textFieldMaxIdealTurns.getText()).doubleValue());
			}
			
			if (m instanceof SkillTrace)
			{
				((SkillTrace)m).setNumMatches(Integer.valueOf(textFieldNumMatches.getText()).intValue());
				((SkillTrace)m).setNumTrialsPerMatch(Integer.valueOf(textFieldNumTrialsPerMatch.getText()).intValue());
				((SkillTrace)m).setHardTimeLimit(Integer.valueOf(textFieldHardTimeLimit.getText()).intValue());
				((SkillTrace)m).setOutputPath(txtcommonresoutput.getText() + File.separatorChar);
			}
		}
		
		final Report report = new Report();
		report.setReportMessageFunctions(new ReportMessengerGUI(app));
		
		// Make a deepcopy of the weights to be used.
		final ArrayList<Double> weightsCopy = new ArrayList<>();
		for (final Double d : weights)
			weightsCopy.add(new Double(d.doubleValue()));
		
		AIPlayer.AIEvalution(app, report, numberIterations, maxTurns, thinkTime, AIName, metrics, weightsCopy, useDatabaseTrialsCheckBox.isSelected());
		DesktopApp.view().tabPanel().select(TabView.PanelAnalysis);
	}

}